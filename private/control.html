<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>FSCOREBOARD Control Panel</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 800px; 
      margin: 20px auto; 
      background: #f4f4f4; 
      padding: 20px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .presets-section {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border: 1px solid #ddd;
    }
    
    .presets-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .presets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .preset-card {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .preset-card:hover {
      border-color: #338af3;
      background: #f8f9ff;
    }
    
    .preset-name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
    }
    
    .preset-teams {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .preset-team {
      text-align: center;
      flex: 1;
    }
    
    .preset-team-name {
      font-weight: bold;
      color: #338af3;
    }
    
    .preset-team-city {
      font-size: 12px;
      color: #666;
    }
    
    .preset-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .btn-primary {
      background: #338af3;
      color: white;
    }
    
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    
    .btn:hover {
      opacity: 0.8;
    }
    
    .add-preset-form {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .form-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-group {
      flex: 1;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    
    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .form-group input[type="color"] {
      width: 60px;
      height: 40px;
      padding: 0;
    }
    
    .camera-content {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border: 1px solid #ddd;
    }
    
    .timer-row { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 16px; 
      margin: 20px 0; 
    }
    
    .playpause-btn, .set-btn {
      width: 56px; 
      height: 44px;
      background: #338af3; 
      color: #fff; 
      border: none; 
      border-radius: 8px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-size: 2em; 
      cursor: pointer; 
      transition: background 0.2s;
    }
    
    .playpause-btn:hover, .set-btn:hover { 
      background: #2561a7; 
    }
    
    .timer-inputs {
      display: flex; 
      align-items: center; 
      gap: 8px;
      background: #fff; 
      border-radius: 8px; 
      padding: 8px 12px;
      border: 1px solid #ccc;
    }
    
    .timer-inputs input[type="text"] {
      width: 80px; 
      font-size: 1.2em; 
      text-align: center; 
      border: none; 
      background: none; 
      outline: none;
      letter-spacing: 2px;
    }
    
    .score-row { 
      display: flex; 
      justify-content: space-between; 
      gap: 30px; 
      margin-top: 20px; 
    }
    
    .score-block { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      padding: 0; 
      min-width: 120px; 
    }
    
    .score-controls { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 8px; 
    }
    
    .score-btn {
      background: #338af3; 
      color: #fff; 
      border: none; 
      border-radius: 8px;
      width: 44px; 
      height: 44px; 
      font-size: 1.4em; 
      font-weight: bold; 
      cursor: pointer;
      display: flex; 
      align-items: center; 
      justify-content: center;
    }
    
    .score-btn:hover { 
      background: #2561a7; 
    }
    
    .score-value { 
      font-size: 2em; 
      color: #338af3; 
      min-width: 32px; 
      text-align: center; 
    }
    
    .short-label-row { 
      margin-top: 6px; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
    }
    
    .short-label-row input[type="text"] {
      width: 50px; 
      text-align: center; 
      font-size: 1.2em; 
      border-radius: 8px; 
      border: 1px solid #ccc; 
      padding: 4px 0;
      background: #fff; 
      text-transform: uppercase; 
      font-weight: bold; 
      letter-spacing: 2px;
    }
    
    .kit-block { 
      display: flex; 
      flex-direction: row; 
      align-items: center; 
      justify-content: center; 
      gap: 0; 
      width: 120px; 
    }
    
    .kit-color {
      width: 100px; 
      height: 32px; 
      border-radius: 4px; 
      border: 1px solid #ccc;
      background: none; 
      margin: 0; 
      padding: 0; 
      cursor: pointer; 
      display: block;
    }
    
    .label-caption {
      font-size: 0.85em; 
      color: #888; 
      margin-bottom: 2px; 
      text-align: center; 
      font-weight: normal; 
      letter-spacing: 1px;
    }
    
    .team-input-row { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      width: 100%; 
      gap: 4px; 
      margin-top: 6px; 
    }
    
    .team-input-row input[type="text"] {
      width: 100%;
      text-align: center; 
      font-size: 1em; 
      border-radius: 8px; 
      border: 1px solid #ccc; 
      padding: 4px 0;
      background: #fff; 
      color: #338af3; 
      font-weight: bold; 
    }
    
    .city-input-row input[type="text"] {
      width: 100%;
      text-align: center; 
      font-size: 1em; 
      border-radius: 8px; 
      border: 1px solid #ccc; 
      padding: 4px 0;
      background: #fff; 
      color: #888; 
      font-weight: normal;
    }
    
    .divider { 
      width: 2px; 
      background: #ccc; 
      margin: 0 10px; 
    }
    
    .hidden {
      display: none;
    }
    
    .version-info {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 0.6em;
      color: #ccc;
      background: rgba(255, 255, 255, 0.8);
      padding: 2px 6px;
      border-radius: 3px;
      opacity: 0.7;
      z-index: 1000;
    }
    
    .preset-card {
      position: relative;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border: 2px solid #ddd;
    }
    
    .preset-card.saved {
      border-color: #28a745;
      background: #f8fff9;
    }
    
    .preset-play-btn {
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    
    .preset-play-btn:hover {
      background: #218838;
    }
    
    .preset-saved-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #28a745;
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: bold;
    }
    
    .preset-edit-icon {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.8;
      transition: opacity 0.2s;
    }
    
    .preset-edit-icon:hover {
      opacity: 1;
      background: #0056b3;
    }
    
    .timer-running-warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: bold;
    }
    
    .disabled-field {
      opacity: 0.6;
      pointer-events: none;
      background-color: #f8f9fa !important;
    }
    
    .preset-card.editable {
      cursor: pointer;
      border-style: dashed;
    }
    
    .preset-card.editable:hover {
      border-color: #007bff;
      background: #f8f9ff;
    }
    
    .edit-preset-form {
      background: #e3f2fd;
      border: 2px solid #2196f3;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .edit-preset-form h3 {
      color: #1976d2;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <!-- –í–µ—Ä—Å–∏—è –≤ —É–≥–ª—É -->
  <div class="version-info">v1.0.0</div>

  <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–æ -->
  <div class="camera-content">
    <div class="timer-row">
      <button id="playPauseBtn" class="playpause-btn" title="–ü—É—Å–∫/–ü–∞—É–∑–∞">
        <svg id="playPauseIcon" width="32" height="32" viewBox="0 0 32 32" fill="none">
          <polygon id="playIcon" points="8,6 26,16 8,26" fill="white"/>
        </svg>
      </button>
      <div class="timer-inputs">
        <input type="text" id="timeInput" maxlength="5" placeholder="MM:SS" pattern="^\d{2}:\d{2}$" value="00:00" autocomplete="off" />
      </div>
      <button id="setBtn" class="set-btn">Set</button>
    </div>
    <form id="controlForm" autocomplete="off" spellcheck="false">
      <div class="score-row">
        <div class="score-block">
          <div class="score-controls">
            <button type="button" class="score-btn" id="score1Dec">-</button>
            <span class="score-value" id="score1Value">0</span>
            <button type="button" class="score-btn" id="score1Inc">+</button>
          </div>
          <div class="short-label-row">
            <input type="text" id="team1Short" maxlength="3" placeholder="–•–û–ó" />
          </div>
          <div class="kit-block">
            <input type="color" id="kit1Color" value="#2b2b2b" class="kit-color">
          </div>
          <div class="team-input-row">
            <span class="label-caption">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</span>
            <input type="text" id="team1Name" maxlength="40" placeholder="–ù–µ –≤–≤–µ–¥–µ–Ω–æ" />
          </div>
          <div class="city-input-row team-input-row">
            <span class="label-caption">–ì–æ—Ä–æ–¥</span>
            <input type="text" id="team1City" maxlength="30" placeholder="–ù–µ –≤–≤–µ–¥–µ–Ω–æ" />
          </div>
        </div>
        <div class="divider"></div>
        <div class="score-block">
          <div class="score-controls">
            <button type="button" class="score-btn" id="score2Dec">-</button>
            <span class="score-value" id="score2Value">0</span>
            <button type="button" class="score-btn" id="score2Inc">+</button>
          </div>
          <div class="short-label-row">
            <input type="text" id="team2Short" maxlength="3" placeholder="–ì–û–°" />
          </div>
          <div class="kit-block">
            <input type="color" id="kit2Color" value="#2b2b2b" class="kit-color">
          </div>
          <div class="team-input-row">
            <span class="label-caption">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</span>
            <input type="text" id="team2Name" maxlength="40" placeholder="–ù–µ –≤–≤–µ–¥–µ–Ω–æ" />
          </div>
          <div class="city-input-row team-input-row">
            <span class="label-caption">–ì–æ—Ä–æ–¥</span>
            <input type="text" id="team2City" maxlength="30" placeholder="–ù–µ –≤–≤–µ–¥–µ–Ω–æ" />
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- –°–µ–∫—Ü–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫ -->
  <div class="presets-section">
    <div class="presets-header">
      <h2>–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ç—á–µ–π</h2>
      <button class="btn btn-primary" onclick="toggleAddPresetForm()" id="addPresetBtn">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫—É</button>
    </div>
    
    <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ä–∞–±–æ—Ç–∞—é—â–µ–º —Ç–∞–π–º–µ—Ä–µ -->
    <div id="timerWarning" class="timer-running-warning hidden">
      ‚ö†Ô∏è –¢–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω! –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–∞–π–º–µ—Ä –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
    </div>
    
    <div id="presetsGrid" class="presets-grid">
      <!-- –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
    
    <div id="addPresetForm" class="add-preset-form hidden">
      <h3>–ù–æ–≤–∞—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞</h3>
      <div class="form-row">
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç—á–∞</label>
          <input type="text" id="presetName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –§–∏–Ω–∞–ª —á–µ–º–ø–∏–æ–Ω–∞—Ç–∞">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 1 - –ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input type="text" id="presetTeam1Name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 1 - –ì–æ—Ä–æ–¥</label>
          <input type="text" id="presetTeam1City" placeholder="–ì–æ—Ä–æ–¥">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 1 - –®–æ—Ä—Ç–∫–æ–¥</label>
          <input type="text" id="presetTeam1Short" placeholder="–•–û–ó" maxlength="3">
        </div>
        <div class="form-group">
          <label>–¶–≤–µ—Ç —Ñ–æ—Ä–º—ã 1</label>
          <input type="color" id="presetKit1Color" value="#2b2b2b">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 2 - –ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input type="text" id="presetTeam2Name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 2 - –ì–æ—Ä–æ–¥</label>
          <input type="text" id="presetTeam2City" placeholder="–ì–æ—Ä–æ–¥">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 2 - –®–æ—Ä—Ç–∫–æ–¥</label>
          <input type="text" id="presetTeam2Short" placeholder="–ì–û–°" maxlength="3">
        </div>
        <div class="form-group">
          <label>–¶–≤–µ—Ç —Ñ–æ—Ä–º—ã 2</label>
          <input type="color" id="presetKit2Color" value="#2b2b2b">
        </div>
      </div>
      <div class="form-row">
        <button class="btn btn-primary" onclick="savePreset()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn" onclick="toggleAddPresetForm()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
    
    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ -->
    <div id="editPresetForm" class="edit-preset-form hidden">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏</h3>
      <div class="form-row">
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç—á–∞</label>
          <input type="text" id="editPresetName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –§–∏–Ω–∞–ª —á–µ–º–ø–∏–æ–Ω–∞—Ç–∞">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 1 - –ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input type="text" id="editPresetTeam1Name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 1 - –ì–æ—Ä–æ–¥</label>
          <input type="text" id="editPresetTeam1City" placeholder="–ì–æ—Ä–æ–¥">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 1 - –®–æ—Ä—Ç–∫–æ–¥</label>
          <input type="text" id="editPresetTeam1Short" placeholder="–•–û–ó" maxlength="3">
        </div>
        <div class="form-group">
          <label>–¶–≤–µ—Ç —Ñ–æ—Ä–º—ã 1</label>
          <input type="color" id="editPresetKit1Color" value="#2b2b2b">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 2 - –ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input type="text" id="editPresetTeam2Name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 2 - –ì–æ—Ä–æ–¥</label>
          <input type="text" id="editPresetTeam2City" placeholder="–ì–æ—Ä–æ–¥">
        </div>
        <div class="form-group">
          <label>–ö–æ–º–∞–Ω–¥–∞ 2 - –®–æ—Ä—Ç–∫–æ–¥</label>
          <input type="text" id="editPresetTeam2Short" placeholder="–ì–û–°" maxlength="3">
        </div>
        <div class="form-group">
          <label>–¶–≤–µ—Ç —Ñ–æ—Ä–º—ã 2</label>
          <input type="color" id="editPresetKit2Color" value="#2b2b2b">
        </div>
      </div>
      <div class="form-row">
        <button class="btn btn-primary" onclick="updatePreset()">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn" onclick="cancelEditPreset()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let presets = [];
    let ready = false;
    let timerRunning = false;
    let editingPresetId = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      loadPresets();
      setupControls();
    });

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
    function setupControls() {
      // –¢–∞–π–º–µ—Ä
      document.getElementById('playPauseBtn').onclick = function() {
        const isRunning = document.getElementById('playPauseIcon').innerHTML.includes('rect');
        socket.emit('updateScoreboard', { 
          timerRunning: !isRunning 
        });
      };
      
      document.getElementById('setBtn').onclick = function() {
        const seconds = getSecondsFromTimeInput('timeInput');
        socket.emit('updateScoreboard', { 
          timerSeconds: seconds 
        });
      };

      // –°—á–µ—Ç
      document.getElementById('score1Inc').onclick = () => {
        const current = parseInt(document.getElementById('score1Value').textContent);
        socket.emit('updateScoreboard', { 
          score1: current + 1 
        });
      };
      
      document.getElementById('score1Dec').onclick = () => {
        const current = parseInt(document.getElementById('score1Value').textContent);
        if (current > 0) {
          socket.emit('updateScoreboard', { 
            score1: current - 1 
          });
        }
      };
      
      document.getElementById('score2Inc').onclick = () => {
        const current = parseInt(document.getElementById('score2Value').textContent);
        socket.emit('updateScoreboard', { 
          score2: current + 1 
        });
      };
      
      document.getElementById('score2Dec').onclick = () => {
        const current = parseInt(document.getElementById('score2Value').textContent);
        if (current > 0) {
          socket.emit('updateScoreboard', { 
            score2: current - 1 
          });
        }
      };

      // –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —à–æ—Ä—Ç–∫–æ–¥–æ–≤
      autoShortName('team1Name', 'team1Short', '–•–û–ó');
      autoShortName('team2Name', 'team2Short', '–ì–û–°');

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      const fields = [
        'team1Name', 'team2Name', 'team1City', 'team2City',
        'kit1Color', 'kit2Color'
      ];
      
      fields.forEach(fieldId => {
        document.getElementById(fieldId).addEventListener('input', () => {
          sendState();
        });
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏
      document.getElementById('timeInput').addEventListener('input', function(e) {
        let v = this.value.replace(/[^\d:]/g, '');
        if (v.length === 2 && !v.includes(':')) v = v + ':';
        if (v.length > 5) v = v.slice(0,5);
        if (v.length === 3 && v[2] !== ':') v = v.slice(0,2) + ':' + v[2];
        if (!/^\d{0,2}:?\d{0,2}$/.test(v)) v = v.slice(0,-1);
        this.value = v;
      });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    function sendState() {
      if (!ready) return;
      socket.emit('updateScoreboard', {
        team1Name: document.getElementById('team1Name').value,
        team1City: document.getElementById('team1City').value,
        team1Short: document.getElementById('team1Short').value,
        team2Name: document.getElementById('team2Name').value,
        team2City: document.getElementById('team2City').value,
        team2Short: document.getElementById('team2Short').value,
        kit1Color: document.getElementById('kit1Color').value,
        kit2Color: document.getElementById('kit2Color').value
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
    async function loadPresets() {
      try {
        const response = await fetch(`/api/presets?token=${getToken()}`);
        presets = await response.json();
        renderPresets();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫:', error);
      }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
    function renderPresets() {
      const grid = document.getElementById('presetsGrid');
      grid.innerHTML = '';
      
      presets.forEach(preset => {
        const card = document.createElement('div');
        card.className = `preset-card saved`;
        card.innerHTML = `
          <div class="preset-saved-indicator">–°–û–•–†–ê–ù–ï–ù–û</div>
          ${!timerRunning ? `<button class="preset-edit-icon" onclick="editPreset('${preset.id}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">üîë</button>` : ''}
          <div class="preset-name">${preset.name}</div>
          <div class="preset-teams">
            <div class="preset-team">
              <div class="preset-team-name">${preset.team1Name}</div>
              <div class="preset-team-city">${preset.team1City}</div>
            </div>
            <div class="preset-team">
              <div class="preset-team-name">${preset.team2Name}</div>
              <div class="preset-team-city">${preset.team2City}</div>
            </div>
          </div>
          <div class="preset-actions">
            <button class="preset-play-btn" onclick="applyPreset('${preset.id}')">‚ñ∂ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <button class="btn btn-danger" onclick="deletePreset('${preset.id}')" ${timerRunning ? 'disabled' : ''}>–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
    function applyPreset(presetId) {
      const preset = presets.find(p => p.id === presetId);
      if (!preset) return;
      
      // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –ø–æ–ª—è–º
      document.getElementById('team1Name').value = preset.team1Name;
      document.getElementById('team1City').value = preset.team1City;
      document.getElementById('team1Short').value = preset.team1Short;
      document.getElementById('kit1Color').value = preset.kit1Color;
      
      document.getElementById('team2Name').value = preset.team2Name;
      document.getElementById('team2City').value = preset.team2City;
      document.getElementById('team2Short').value = preset.team2Short;
      document.getElementById('kit2Color').value = preset.kit2Color;
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
      sendState();
      
      // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      showNotification(`–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞: ${preset.name}`, 'success');
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
    async function deletePreset(presetId) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫—É?')) return;
      
      try {
        await fetch(`/api/presets/${presetId}?token=${getToken()}`, {
          method: 'DELETE'
        });
        loadPresets();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏:', error);
      }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
    async function savePreset() {
      const preset = {
        name: document.getElementById('presetName').value.trim(),
        team1Name: document.getElementById('presetTeam1Name').value.trim(),
        team1City: document.getElementById('presetTeam1City').value.trim(),
        team1Short: document.getElementById('presetTeam1Short').value.trim().toUpperCase(),
        team2Name: document.getElementById('presetTeam2Name').value.trim(),
        team2City: document.getElementById('presetTeam2City').value.trim(),
        team2Short: document.getElementById('presetTeam2Short').value.trim().toUpperCase(),
        kit1Color: document.getElementById('presetKit1Color').value,
        kit2Color: document.getElementById('presetKit2Color').value
      };

      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!preset.name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç—á–∞');
        return;
      }
      
      if (!preset.team1Name || !preset.team2Name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥');
        return;
      }

      try {
        const response = await fetch(`/api/presets?token=${getToken()}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(preset)
        });
        
        if (!response.ok) {
          throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏');
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('addPresetForm').querySelectorAll('input').forEach(input => {
          if (input.type === 'text') input.value = '';
          if (input.type === 'color') {
            if (input.id.includes('Kit1')) input.value = '#2b2b2b';
            if (input.id.includes('Kit2')) input.value = '#2b2b2b';
          }
        });
        
        // –°–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã
        toggleAddPresetForm();
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
        await loadPresets();
        
        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ
        showNotification('–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏:', error);
        showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏', 'error');
      }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
    function toggleAddPresetForm() {
      if (timerRunning) {
        showNotification('–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞!', 'error');
        return;
      }
      const form = document.getElementById('addPresetForm');
      form.classList.toggle('hidden');
    }
    
    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
    function editPreset(presetId) {
      if (timerRunning) {
        showNotification('–ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞!', 'error');
        return;
      }
      
      const preset = presets.find(p => p.id === presetId);
      if (!preset) return;
      
      editingPresetId = presetId;
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      document.getElementById('editPresetName').value = preset.name;
      document.getElementById('editPresetTeam1Name').value = preset.team1Name;
      document.getElementById('editPresetTeam1City').value = preset.team1City;
      document.getElementById('editPresetTeam1Short').value = preset.team1Short;
      document.getElementById('editPresetKit1Color').value = preset.kit1Color;
      document.getElementById('editPresetTeam2Name').value = preset.team2Name;
      document.getElementById('editPresetTeam2City').value = preset.team2City;
      document.getElementById('editPresetTeam2Short').value = preset.team2Short;
      document.getElementById('editPresetKit2Color').value = preset.kit2Color;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      document.getElementById('editPresetForm').classList.remove('hidden');
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
    async function updatePreset() {
      if (!editingPresetId) return;
      
      const preset = {
        name: document.getElementById('editPresetName').value.trim(),
        team1Name: document.getElementById('editPresetTeam1Name').value.trim(),
        team1City: document.getElementById('editPresetTeam1City').value.trim(),
        team1Short: document.getElementById('editPresetTeam1Short').value.trim().toUpperCase(),
        team2Name: document.getElementById('editPresetTeam2Name').value.trim(),
        team2City: document.getElementById('editPresetTeam2City').value.trim(),
        team2Short: document.getElementById('editPresetTeam2Short').value.trim().toUpperCase(),
        kit1Color: document.getElementById('editPresetKit1Color').value,
        kit2Color: document.getElementById('editPresetKit2Color').value
      };

      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!preset.name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç—á–∞');
        return;
      }
      
      if (!preset.team1Name || !preset.team2Name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥');
        return;
      }

      try {
        const response = await fetch(`/api/presets/${editingPresetId}?token=${getToken()}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(preset)
        });
        
        if (!response.ok) {
          throw new Error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏');
        }
        
        // –°–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã
        cancelEditPreset();
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
        await loadPresets();
        
        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ
        showNotification('–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏', 'error');
      }
    }
    
    // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function cancelEditPreset() {
      editingPresetId = null;
      document.getElementById('editPresetForm').classList.add('hidden');
    }

    // –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —à–æ—Ä—Ç–∫–æ–¥–æ–≤
    function autoShortName(fullId, shortId, def) {
      const fullInput = document.getElementById(fullId);
      const shortInput = document.getElementById(shortId);
      let manual = false;

      function updateShort() {
        if (!manual) {
          shortInput.value = (fullInput.value || def).toUpperCase().slice(0,3);
        }
      }
      fullInput.addEventListener('input', updateShort);
      shortInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase().replace(/[^A-Z–ê-–Ø–Å0-9]/gi, '').slice(0,3);
        manual = true;
      });
      updateShort();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
    socket.on('scoreboardUpdate', (data) => {
      ready = false;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
      const isRunning = !!data.timerRunning;
      timerRunning = isRunning;
      setPlayPauseIcon('playPauseIcon', isRunning);
      setTimeInputFromSeconds('timeInput', data.timerSeconds || 0);
      document.getElementById('timeInput').disabled = isRunning;
      
      // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Ç–∞–π–º–µ—Ä–µ
      const warning = document.getElementById('timerWarning');
      if (isRunning) {
        warning.classList.remove('hidden');
      } else {
        warning.classList.add('hidden');
      }
      
      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Ç–∞–π–º–µ—Ä–∞
      const fieldsToDisable = [
        'team1Name', 'team1City', 'team1Short', 'kit1Color',
        'team2Name', 'team2City', 'team2Short', 'kit2Color'
      ];
      
      fieldsToDisable.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (isRunning) {
          field.classList.add('disabled-field');
        } else {
          field.classList.remove('disabled-field');
        }
      });
      
      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
      const addBtn = document.getElementById('addPresetBtn');
      if (isRunning) {
        addBtn.disabled = true;
        addBtn.textContent = '‚è∏Ô∏è –¢–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω';
      } else {
        addBtn.disabled = false;
        addBtn.textContent = '+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫—É';
      }
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
      document.getElementById('score1Value').textContent = data.score1 ?? 0;
      document.getElementById('score2Value').textContent = data.score2 ?? 0;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
      document.getElementById('team1Short').value = data.team1Short ?? "";
      document.getElementById('team2Short').value = data.team2Short ?? "";
      document.getElementById('kit1Color').value = data.kit1Color ?? "#2b2b2b";
      document.getElementById('kit2Color').value = data.kit2Color ?? "#2b2b2b";
      document.getElementById('team1Name').value = data.team1Name ?? "";
      document.getElementById('team2Name').value = data.team2Name ?? "";
      document.getElementById('team1City').value = data.team1City ?? "";
      document.getElementById('team2City').value = data.team2City ?? "";
      
      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫ —Å —É—á–µ—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
      renderPresets();
      
      setTimeout(() => { ready = true; }, 50);
    });

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function setPlayPauseIcon(iconId, isPlaying) {
      const icon = document.getElementById(iconId);
      icon.innerHTML = isPlaying
        ? `<rect x="8" y="6" width="5" height="20" fill="white"/><rect x="19" y="6" width="5" height="20" fill="white"/>`
        : `<polygon points="8,6 26,16 8,26" fill="white"/>`;
    }

    function setTimeInputFromSeconds(inputId, sec) {
      const input = document.getElementById(inputId);
      const mm = Math.floor(sec/60).toString().padStart(2, '0');
      const ss = (sec%60).toString().padStart(2, '0');
      input.value = `${mm}:${ss}`;
    }

    function getSecondsFromTimeInput(inputId) {
      const val = document.getElementById(inputId).value;
      if (/^\d{2}:\d{2}$/.test(val)) {
        const [mm, ss] = val.split(':').map(Number);
        return mm*60 + ss;
      }
      return 0;
    }

    function getToken() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('token') || 'MySecret111';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type = 'info') {
      // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
        color: white;
        padding: 12px 20px;
        border-radius: 4px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 10000;
        font-size: 14px;
        max-width: 300px;
        animation: slideIn 0.3s ease-out;
      `;
      notification.textContent = message;
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∞–Ω–∏–º–∞—Ü–∏–∏
      if (!document.getElementById('notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      }
      
      document.body.appendChild(notification);
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }
  </script>
</body>
</html>