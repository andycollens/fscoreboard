<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preloader - FSCOREBOARD</title>
    <style>
        @font-face {
            font-family: 'RPL';
            src: url('/public/fonts/RPL.ttf') format('truetype');
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: #0a0a0a;
            font-family: 'RPL', Arial, sans-serif;
            overflow: hidden;
        }

        /* Контейнер SVG для анимации */
        #logo-background-svg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* Ключевой стиль для анимации: плавный переход цвета для каждого треугольника */
        .logo-triangle {
            transition: fill 1s ease-in-out;
        }

        /* Стили для контейнера логотипа */
        #logo-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #logo-image {
            max-width: 80vw;
            max-height: 80vh;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        /* Адаптивность для мобильных устройств */
        @media (max-width: 768px) {
            #logo-image {
                max-width: 90vw;
                max-height: 90vh;
            }
        }
    </style>
</head>
<body>
    <!-- SVG-элемент, который будет заполнен треугольниками с помощью JavaScript -->
    <svg id="logo-background-svg"></svg>

    <!-- Контейнер для логотипа, размещенный поверх SVG -->
    <div id="logo-container">
        <img id="logo-image" src="/public/img/iskra-logo.png" alt="ISKRA Logo">
    </div>

    <script>
        let logoAnimationInterval = null;
        let logoResizeTimeout = null;
        let logoResizeHandler = null;

        function initLogoAnimation() {
            const svg = document.getElementById('logo-background-svg');
            if (!svg) {
                console.error('SVG element not found for logo animation');
                return;
            }

            // Останавливаем предыдущую анимацию, если она была запущена
            if (logoAnimationInterval) {
                clearInterval(logoAnimationInterval);
                logoAnimationInterval = null;
            }

            // Удаляем предыдущий обработчик resize, если он был
            if (logoResizeHandler) {
                window.removeEventListener('resize', logoResizeHandler);
                logoResizeHandler = null;
            }

            const namespace = "http://www.w3.org/2000/svg";

            // Палитра темных цветов
            const colors = ['#080808', '#101010', '#181818', '#202020', '#282828'];

            // Параметры сетки
            const triangleSize = 40;
            const triangleHeight = triangleSize * Math.sqrt(3) / 2;

            let screenWidth = window.innerWidth;
            let screenHeight = window.innerHeight;

            function createGrid() {
                screenWidth = window.innerWidth;
                screenHeight = window.innerHeight;

                svg.setAttribute('width', screenWidth);
                svg.setAttribute('height', screenHeight);
                svg.setAttribute('viewBox', `0 0 ${screenWidth} ${screenHeight}`);

                // Очищаем SVG перед перерисовкой
                while (svg.firstChild) {
                    svg.removeChild(svg.firstChild);
                }
                
                const numCols = Math.ceil(screenWidth / triangleSize) + 1;
                const numRows = Math.ceil(screenHeight / triangleHeight) + 1;

                for (let row = 0; row < numRows; row++) {
                    for (let col = 0; col < numCols; col++) {
                        const x = col * triangleSize;
                        const y = row * triangleHeight;
                        const offsetX = (row % 2 === 0) ? 0 : triangleSize / 2;
                        const randomColor1 = colors[Math.floor(Math.random() * colors.length)];
                        const randomColor2 = colors[Math.floor(Math.random() * colors.length)];

                        createTriangle(x - offsetX, y, 'down', randomColor1);
                        createTriangle(x - offsetX + (triangleSize / 2), y, 'up', randomColor2);
                    }
                }
            }

            function createTriangle(x, y, direction, color) {
                const polygon = document.createElementNS(namespace, 'polygon');
                polygon.classList.add('logo-triangle');

                let points;
                if (direction === 'up') {
                    points = `${x},${y + triangleHeight} ${x + triangleSize / 2},${y} ${x + triangleSize},${y + triangleHeight}`;
                } else {
                    points = `${x},${y} ${x + triangleSize},${y} ${x + triangleSize / 2},${y + triangleHeight}`;
                }

                polygon.setAttribute('points', points);
                polygon.setAttribute('fill', color);
                svg.appendChild(polygon);
            }

            function animateMosaic() {
                const allTriangles = document.querySelectorAll('.logo-triangle');
                if (allTriangles.length === 0) return;

                const randomIndex = Math.floor(Math.random() * allTriangles.length);
                const triangleToAnimate = allTriangles[randomIndex];

                const currentColor = triangleToAnimate.getAttribute('fill');
                let newColor;
                do {
                    newColor = colors[Math.floor(Math.random() * colors.length)];
                } while (newColor === currentColor);

                triangleToAnimate.setAttribute('fill', newColor);
            }

            // Запускаем создание сетки и анимацию
            createGrid();

            // Запускаем анимацию
            logoAnimationInterval = setInterval(animateMosaic, 100);

            // Перерисовываем сетку при изменении размера окна
            logoResizeHandler = () => {
                clearTimeout(logoResizeTimeout);
                logoResizeTimeout = setTimeout(() => {
                    createGrid();
                }, 250);
            };
            window.addEventListener('resize', logoResizeHandler);
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Preloader page loaded');
            setTimeout(() => {
                initLogoAnimation();
            }, 100);
        });

        // Очистка при выгрузке страницы
        window.addEventListener('beforeunload', () => {
            if (logoAnimationInterval) {
                clearInterval(logoAnimationInterval);
            }
            if (logoResizeHandler) {
                window.removeEventListener('resize', logoResizeHandler);
            }
        });
    </script>
</body>
</html>

